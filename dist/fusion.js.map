{"version":3,"file":"fusion.js","sources":["../fusion.js"],"sourcesContent":["const {\n    Sink\n} = require('./common')\n\nfunction compose(g, f) {\n    return x => g(f(x))\n}\n\nfunction and(a, b) {\n    return x => a(x) && b(x)\n}\nclass Filter extends Sink {\n    init(f) {\n        this.f = f\n    }\n    next(data) {\n        const f = this.f\n        f(data) && this.sink.next(data)\n    }\n    fusionFilter(f) {\n        this.f = and(f, this.f)\n        return this\n        // return new Filter(this.sink, this.and(f, this.f))\n    }\n}\nexports.Filter = Filter\n\nclass FilterMapSink extends Sink {\n    init(f, m) {\n        this.f = f\n        this.m = m\n    }\n    next(data) {\n        const f = this.f\n        const m = this.m\n        f(data) && this.sink.next(m(data))\n    }\n    fusionFilter(f) {\n        this.f = and(f, this.f)\n        return this\n        // return new Filter(this, f)\n    }\n}\nclass MapSink extends Sink {\n    init(f) {\n        this.f = f\n    }\n    next(data) {\n        const f = this.f\n        this.sink.next(f(data))\n    }\n    fusionFilter(f) {\n        this.disposePass = false\n        this.dispose(false)\n        return new FilterMapSink(this.sink, f, this.f)\n    }\n    fusionMap(f) {\n        this.f = compose(this.f, f)\n        return this\n        // return new MapSink(this.sink, this.compose(this.f, f))\n    }\n}\nexports.MapSink = MapSink"],"names":["require","Sink","compose","g","f","x","and","a","b","Filter","data","sink","next","exports","FilterMapSink","m","MapSink","disposePass","dispose"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;eAEIA,OAAO,CAAC,UAAD;IADPC,gBAAAA;;AAGJ,SAASC,OAAT,CAAiBC,CAAjB,EAAoBC,CAApB,EAAuB;AACnB,SAAO,UAAAC,CAAC;AAAA,WAAIF,CAAC,CAACC,CAAC,CAACC,CAAD,CAAF,CAAL;AAAA,GAAR;AACH;;AAED,SAASC,GAAT,CAAaC,CAAb,EAAgBC,CAAhB,EAAmB;AACf,SAAO,UAAAH,CAAC;AAAA,WAAIE,CAAC,CAACF,CAAD,CAAD,IAAQG,CAAC,CAACH,CAAD,CAAb;AAAA,GAAR;AACH;;IACKI;;;;;;;;;;;;;yBACGL,GAAG;AACJ,WAAKA,CAAL,GAASA,CAAT;AACH;;;yBACIM,MAAM;AACP,UAAMN,CAAC,GAAG,KAAKA,CAAf;AACAA,MAAAA,CAAC,CAACM,IAAD,CAAD,IAAW,KAAKC,IAAL,CAAUC,IAAV,CAAeF,IAAf,CAAX;AACH;;;iCACYN,GAAG;AACZ,WAAKA,CAAL,GAASE,GAAG,CAACF,CAAD,EAAI,KAAKA,CAAT,CAAZ;AACA,aAAO,IAAP,CAFY;AAIf;;;;EAZgBH;;AAcrBY,OAAO,CAACJ,MAAR,GAAiBA,MAAjB;;IAEMK;;;;;;;;;;;;;yBACGV,GAAGW,GAAG;AACP,WAAKX,CAAL,GAASA,CAAT;AACA,WAAKW,CAAL,GAASA,CAAT;AACH;;;yBACIL,MAAM;AACP,UAAMN,CAAC,GAAG,KAAKA,CAAf;AACA,UAAMW,CAAC,GAAG,KAAKA,CAAf;AACAX,MAAAA,CAAC,CAACM,IAAD,CAAD,IAAW,KAAKC,IAAL,CAAUC,IAAV,CAAeG,CAAC,CAACL,IAAD,CAAhB,CAAX;AACH;;;iCACYN,GAAG;AACZ,WAAKA,CAAL,GAASE,GAAG,CAACF,CAAD,EAAI,KAAKA,CAAT,CAAZ;AACA,aAAO,IAAP,CAFY;AAIf;;;;EAduBH;;IAgBtBe;;;;;;;;;;;;;yBACGZ,GAAG;AACJ,WAAKA,CAAL,GAASA,CAAT;AACH;;;yBACIM,MAAM;AACP,UAAMN,CAAC,GAAG,KAAKA,CAAf;AACA,WAAKO,IAAL,CAAUC,IAAV,CAAeR,CAAC,CAACM,IAAD,CAAhB;AACH;;;iCACYN,GAAG;AACZ,WAAKa,WAAL,GAAmB,KAAnB;AACA,WAAKC,OAAL,CAAa,KAAb;AACA,aAAO,IAAIJ,aAAJ,CAAkB,KAAKH,IAAvB,EAA6BP,CAA7B,EAAgC,KAAKA,CAArC,CAAP;AACH;;;8BACSA,GAAG;AACT,WAAKA,CAAL,GAASF,OAAO,CAAC,KAAKE,CAAN,EAASA,CAAT,CAAhB;AACA,aAAO,IAAP,CAFS;AAIZ;;;;EAjBiBH;;AAmBtBY,OAAO,CAACG,OAAR,GAAkBA,OAAlB;;"}