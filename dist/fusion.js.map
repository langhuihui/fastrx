{"version":3,"file":"fusion.js","sources":["../fusion.js"],"sourcesContent":["const {\r\n    Sink\r\n} = require('./common')\r\n\r\nfunction compose(g, f) {\r\n    return x => g(f(x))\r\n}\r\n\r\nfunction and(a, b) {\r\n    return x => a(x) && b(x)\r\n}\r\nclass Filter extends Sink {\r\n    init(f) {\r\n        this.f = f\r\n    }\r\n    next(data) {\r\n        const f = this.f\r\n        f(data) && this.sink.next(data)\r\n    }\r\n    fusionFilter(f) {\r\n        this.f = and(f, this.f)\r\n        return this\r\n        // return new Filter(this.sink, this.and(f, this.f))\r\n    }\r\n}\r\nexports.Filter = Filter\r\n\r\nclass FilterMapSink extends Sink {\r\n    init(f, m) {\r\n        this.f = f\r\n        this.m = m\r\n    }\r\n    next(data) {\r\n        const f = this.f\r\n        const m = this.m\r\n        f(data) && this.sink.next(m(data))\r\n    }\r\n    fusionFilter(f) {\r\n        this.f = and(f, this.f)\r\n        return this\r\n        // return new Filter(this, f)\r\n    }\r\n}\r\nclass MapSink extends Sink {\r\n    init(f) {\r\n        this.f = f\r\n    }\r\n    next(data) {\r\n        const f = this.f\r\n        this.sink.next(f(data))\r\n    }\r\n    fusionFilter(f) {\r\n        this.disposePass = false\r\n        this.dispose(false)\r\n        return new FilterMapSink(this.sink, f, this.f)\r\n    }\r\n    fusionMap(f) {\r\n        this.f = compose(this.f, f)\r\n        return this\r\n        // return new MapSink(this.sink, this.compose(this.f, f))\r\n    }\r\n}\r\nexports.MapSink = MapSink"],"names":["require","Sink","compose","g","f","x","and","a","b","Filter","data","sink","next","exports","FilterMapSink","m","MapSink","disposePass","dispose"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;eAEIA,OAAO,CAAC,UAAD;IADPC,gBAAAA;;AAGJ,SAASC,OAAT,CAAiBC,CAAjB,EAAoBC,CAApB,EAAuB;AACnB,SAAO,UAAAC,CAAC;AAAA,WAAIF,CAAC,CAACC,CAAC,CAACC,CAAD,CAAF,CAAL;AAAA,GAAR;AACH;;AAED,SAASC,GAAT,CAAaC,CAAb,EAAgBC,CAAhB,EAAmB;AACf,SAAO,UAAAH,CAAC;AAAA,WAAIE,CAAC,CAACF,CAAD,CAAD,IAAQG,CAAC,CAACH,CAAD,CAAb;AAAA,GAAR;AACH;;IACKI;;;;;;;;;;;;;yBACGL,GAAG;AACJ,WAAKA,CAAL,GAASA,CAAT;AACH;;;yBACIM,MAAM;AACP,UAAMN,CAAC,GAAG,KAAKA,CAAf;AACAA,MAAAA,CAAC,CAACM,IAAD,CAAD,IAAW,KAAKC,IAAL,CAAUC,IAAV,CAAeF,IAAf,CAAX;AACH;;;iCACYN,GAAG;AACZ,WAAKA,CAAL,GAASE,GAAG,CAACF,CAAD,EAAI,KAAKA,CAAT,CAAZ;AACA,aAAO,IAAP,CAFY;AAIf;;;;EAZgBH;;AAcrBY,OAAO,CAACJ,MAAR,GAAiBA,MAAjB;;IAEMK;;;;;;;;;;;;;yBACGV,GAAGW,GAAG;AACP,WAAKX,CAAL,GAASA,CAAT;AACA,WAAKW,CAAL,GAASA,CAAT;AACH;;;yBACIL,MAAM;AACP,UAAMN,CAAC,GAAG,KAAKA,CAAf;AACA,UAAMW,CAAC,GAAG,KAAKA,CAAf;AACAX,MAAAA,CAAC,CAACM,IAAD,CAAD,IAAW,KAAKC,IAAL,CAAUC,IAAV,CAAeG,CAAC,CAACL,IAAD,CAAhB,CAAX;AACH;;;iCACYN,GAAG;AACZ,WAAKA,CAAL,GAASE,GAAG,CAACF,CAAD,EAAI,KAAKA,CAAT,CAAZ;AACA,aAAO,IAAP,CAFY;AAIf;;;;EAduBH;;IAgBtBe;;;;;;;;;;;;;yBACGZ,GAAG;AACJ,WAAKA,CAAL,GAASA,CAAT;AACH;;;yBACIM,MAAM;AACP,UAAMN,CAAC,GAAG,KAAKA,CAAf;AACA,WAAKO,IAAL,CAAUC,IAAV,CAAeR,CAAC,CAACM,IAAD,CAAhB;AACH;;;iCACYN,GAAG;AACZ,WAAKa,WAAL,GAAmB,KAAnB;AACA,WAAKC,OAAL,CAAa,KAAb;AACA,aAAO,IAAIJ,aAAJ,CAAkB,KAAKH,IAAvB,EAA6BP,CAA7B,EAAgC,KAAKA,CAArC,CAAP;AACH;;;8BACSA,GAAG;AACT,WAAKA,CAAL,GAASF,OAAO,CAAC,KAAKE,CAAN,EAASA,CAAT,CAAhB;AACA,aAAO,IAAP,CAFS;AAIZ;;;;EAjBiBH;;AAmBtBY,OAAO,CAACG,OAAR,GAAkBA,OAAlB;;"}