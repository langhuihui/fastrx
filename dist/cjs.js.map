{"version":3,"file":"cjs.js","sources":["../index.js"],"sourcesContent":["const {\r\n    Sink,\r\n    deliver,\r\n    noop\r\n} = require('./common')\r\nexports.Sink = Sink\r\nexports.pipe = (first, ...cbs) => cbs.reduce((aac, c) => c(aac), first);\r\n\r\nclass Reuse {\r\n    constructor(subscribe, ...args) {\r\n        this.subscribe = subscribe\r\n        this.source = exports.pipe(...args)\r\n    }\r\n    start() {\r\n        this.subscriber = this.subscribe(this.source)\r\n    }\r\n    stop() {\r\n        this.subscriber && this.subscriber.dispose()\r\n    }\r\n}\r\n\r\n//在pipe的基础上增加了start和stop方法，方便反复调用\r\nexports.reusePipe = (...args) => new Reuse(...args)\r\n\r\nexports.toPromise = source => new Promise((resolve, reject) => {\r\n    const sink = new Sink()\r\n    sink.next = d => sink.value = d\r\n    sink.complete = err => err ? reject(err) : resolve(sink.value)\r\n    source(sink)\r\n})\r\n\r\n//SUBSCRIBER\r\nexports.subscribe = (n, e = noop, c = noop) => source => {\r\n    const sink = new Sink()\r\n    sink.next = n\r\n    sink.complete = err => err ? e(err) : c()\r\n    source(sink)\r\n    return sink\r\n}\r\n// UTILITY \r\nclass Tap extends Sink {\r\n    init(f) {\r\n        this.f = f\r\n    }\r\n    next(data) {\r\n        const f = this.f\r\n        f(data)\r\n        this.sink.next(data)\r\n    }\r\n}\r\n\r\nexports.tap = deliver(Tap)\r\n\r\nclass Delay extends Sink {\r\n    init(delay) {\r\n        this.delayTime = delay\r\n        this.buffer = []\r\n        this.timeoutId = [clearTimeout, ,]\r\n        this.defer(this.timeoutId)\r\n    }\r\n    delay(delay) {\r\n        this.timeoutId[2] = setTimeout(this.pop, delay, this)\r\n    }\r\n    pop(_this) {\r\n        const { time: lastTime, data } = _this.buffer.shift()\r\n        _this.sink.next(data)\r\n        if (_this.buffer.length) {\r\n            _this.delay(_this.buffer[0].time - lastTime)\r\n        }\r\n    }\r\n    next(data) {\r\n        if (!this.buffer.length) {\r\n            this.delay(this.delayTime)\r\n        }\r\n        this.buffer.push({ time: new Date, data })\r\n    }\r\n    complete(err) {\r\n        if (err) this.sink.complete(err)\r\n        else {\r\n            this.timeoutId[2] = setTimeout(() => this.sink.complete(), this.delayTime)\r\n        }\r\n    }\r\n}\r\nexports.delay = deliver(Delay)\r\nclass CatchError extends Sink {\r\n    init(selector) {\r\n        this.selector = selector\r\n    }\r\n    complete(err) {\r\n        if (err) {\r\n            this.selector(err)(this.sink)\r\n        } else {\r\n            super.complete()\r\n        }\r\n    }\r\n}\r\nexports.catchError = deliver(CatchError)\r\nObject.assign(exports, require('./combination'), require('./filtering'), require('./mathematical'), require('./producer'), require('./transformation'), require('./vue3'))\r\n\r\nif (typeof Proxy == 'undefined') {\r\n    const prototype = {};\r\n    //将一个Observable函数的原型修改为具有所有operator的方法\r\n    const rx = f => Object.setPrototypeOf(f, prototype);\r\n    //提供动态添加Obserable以及operator的方法\r\n    rx.set = ext => {\r\n        for (let key in ext) {\r\n            const f = ext[key]\r\n            switch (key) {\r\n                case 'Sink':\r\n                case 'pipe':\r\n                case 'reusePipe':\r\n                    break\r\n                case 'subscribe':\r\n                    prototype[key] = function (...args) { return f(...args)(this) }\r\n                    break\r\n                case 'toPromise':\r\n                    prototype[key] = function () { return f(this) }\r\n                    break\r\n                default:\r\n                    prototype[key] = function (...args) { return rx(f(...args)(this)) }\r\n                    rx[key] = (...args) => rx(f(...args))\r\n            }\r\n        }\r\n    }\r\n    rx.set(exports)\r\n    exports.rx = rx\r\n} else {\r\n    //该代理可以实现将pipe模式转成链式编程\r\n    const rxProxy = {\r\n        get: (target, prop) => target[prop] || ((...args) => new Proxy(exports[prop](...args)(target), rxProxy))\r\n    }\r\n    exports.rx = new Proxy(f => new Proxy(f, rxProxy), {\r\n        get: (target, prop) => (...args) => new Proxy(exports[prop](...args), rxProxy),\r\n        set: (target, prop, value) => exports[prop] = value\r\n    })\r\n}"],"names":["require","Sink","deliver","noop","exports","pipe","first","cbs","reduce","aac","c","Reuse","subscribe","args","source","subscriber","dispose","reusePipe","toPromise","Promise","resolve","reject","sink","next","d","value","complete","err","n","e","Tap","f","data","tap","Delay","delay","delayTime","buffer","timeoutId","clearTimeout","defer","setTimeout","pop","_this","shift","lastTime","time","length","push","Date","CatchError","selector","catchError","Object","assign","Proxy","prototype","rx","setPrototypeOf","set","ext","key","rxProxy","get","target","prop"],"mappings":"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"}