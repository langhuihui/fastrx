{"version":3,"file":"producer.js","sources":["../producer.js"],"sourcesContent":["const {\r\n    Sink,\r\n    noop,\r\n} = require('./common')\r\nconst {\r\n    share\r\n} = require('./combination')\r\nexports.subject = source => {\r\n    let subSink = null\r\n    const observable = share()(sink => {\r\n        subSink = sink\r\n        source && source(subSink)\r\n    })\r\n    observable.next = d => subSink && subSink.next(d)\r\n    observable.complete = () => subSink && subSink.complete()\r\n    observable.error = err => subSink && subSink.complete(err)\r\n    return observable\r\n}\r\n\r\nexports.fromArray = array => sink => {\r\n    let pos = 0\r\n    const l = array.length\r\n    while (pos < l && !sink.disposed) sink.next(array[pos++])\r\n    sink.complete()\r\n}\r\nexports.of = (...items) => exports.fromArray(items)\r\nexports.interval = period => sink => {\r\n    let i = 0;\r\n    sink.defer([clearInterval, , setInterval(() => sink.next(i++), period)])\r\n}\r\nexports.timer = (delay, period) => sink => {\r\n    const defer = [clearTimeout, , setTimeout(() => {\r\n        if (period) {\r\n            defer[0] = clearInterval\r\n            let i = 0;\r\n            defer[2] = setInterval(() => sink.next(i++), period)\r\n        } else {\r\n            sink.next(0)\r\n            sink.complete()\r\n        }\r\n    }, delay)]\r\n    sink.defer(defer)\r\n}\r\nexports.fromAnimationFrame = () => sink => {\r\n    function next(t) {\r\n        sink.next(t)\r\n        defer[2] = requestAnimationFrame(next)\r\n    }\r\n    const defer =\r\n        [cancelAnimationFrame, , requestAnimationFrame(next)]\r\n    sink.defer(defer)\r\n}\r\nexports.fromEventPattern = (add, remove) => sink => {\r\n    const n = d => sink.next(d);\r\n    sink.defer([remove, , n])\r\n    add(n)\r\n}\r\nexports.fromEvent = (target, name) => {\r\n    const addF = ['on', 'addEventListener', 'addListener'].find(x => typeof target[x] == 'function')\r\n    const removeF = ['off', 'removeEventListener', 'removeListener'].find(x => typeof target[x] == 'function')\r\n    if (addF && removeF)\r\n        return exports.fromEventPattern(handler => target[addF](name, handler), handler => target[removeF](name, handler))\r\n    else throw 'target is not a EventDispachter'\r\n}\r\nexports.fromVueEvent = (vm, name) => sink => {\r\n    const ls = e => sink.next(e)\r\n    vm.$on(name, ls)\r\n    sink.defer([vm.$off, vm, ls])\r\n}\r\nexports.fromVueEventOnce = (vm, name) => sink => vm.$once(name, e => sink.next(e))\r\n\r\nexports.fromEventSource = (src, arg) => sink => {\r\n    if (typeof EventSource == 'undefined') {\r\n        return sink.complete(new Error('No EventSource defined!'))\r\n    }\r\n    const evtSource = new EventSource(src, arg)\r\n    evtSource.onerror = err => sink.complete(err)\r\n    evtSource.onmessage = evt => sink.next(evt.data)\r\n    sink.defer([evtSource.close, evtSource])\r\n}\r\nexports.fromFetch = (url, opt) => sink => {\r\n    fetch(url, opt).then(res => {\r\n        sink.next(res)\r\n        sink.complete()\r\n    }).catch(err => sink.complete(err))\r\n}\r\nexports.fromNextTick = vm => sink => {\r\n    vm.$nextTick(() => {\r\n        sink.next(vm)\r\n        sink.complete()\r\n    })\r\n}\r\nexports.range = (start, count) => (sink, pos = start, end = count + start) => {\r\n    while (pos < end && !sink.disposed) sink.next(pos++)\r\n    sink.complete()\r\n}\r\n\r\nexports.fromPromise = source => sink => {\r\n    source.then(d => (sink.next(d), sink.complete())).catch(e => sink.complete(e))\r\n}\r\n\r\nexports.fromIterable = source => sink => {\r\n    try {\r\n        for (let data of source) {\r\n            sink.next(data)\r\n            if (sink.disposed) return\r\n        }\r\n        sink.complete()\r\n    } catch (err) {\r\n        sink.complete(err)\r\n    }\r\n}\r\nexports.from = source => {\r\n    switch (true) {\r\n        case source instanceof Array:\r\n            return exports.fromArray(source)\r\n        case source instanceof Promise:\r\n            return exports.fromPromise(source)\r\n        case source[Symbol.iterator] && typeof source[Symbol.iterator] === 'function':\r\n            return exports.fromIterable(source)\r\n        default:\r\n            return exports.of(source)\r\n    }\r\n}\r\nexports.bindCallback = (call, thisArg, ...args) => sink => {\r\n    const inArgs = args.concat((...rargs) => (sink.next(rargs.length > 1 ? rargs : rargs[0]), sink.complete()));\r\n    call.apply ? call.apply(thisArg, inArgs) : call(...inArgs)\r\n}\r\nexports.bindNodeCallback = (call, thisArg, ...args) => sink => {\r\n    const inArgs = args.concat((err, ...rargs) => err ? sink.complete(err) : (sink.next(rargs.length > 1 ? rargs : rargs[0]), sink.complete()));\r\n    call.apply ? call.apply(thisArg, inArgs) : call(...inArgs)\r\n}\r\nexports.never = () => noop\r\nexports.throwError = e => sink => sink.complete(e)\r\nexports.empty = () => exports.throwError()\r\n"],"names":["require","Sink","noop","share","exports","subject","source","subSink","observable","sink","next","d","complete","error","err","fromArray","array","pos","l","length","disposed","of","items","interval","period","i","defer","clearInterval","setInterval","timer","delay","clearTimeout","setTimeout","fromAnimationFrame","t","requestAnimationFrame","cancelAnimationFrame","fromEventPattern","add","remove","n","fromEvent","target","name","addF","find","x","removeF","handler","fromVueEvent","vm","ls","e","$on","$off","fromVueEventOnce","$once","fromEventSource","src","arg","EventSource","Error","evtSource","onerror","onmessage","evt","data","close","fromFetch","url","opt","fetch","then","res","catch","fromNextTick","$nextTick","range","start","count","end","fromPromise","fromIterable","from","Array","Promise","Symbol","iterator","bindCallback","call","thisArg","args","inArgs","concat","rargs","apply","bindNodeCallback","never","throwError","empty"],"mappings":"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"}