{"version":3,"file":"filtering.js","sources":["../filtering.js"],"sourcesContent":["const {\n    Sink,\n    deliver,\n    noop\n} = require('./common')\nconst {\n    Filter\n} = require('./fusion')\nconst {\n    reduce\n} = require('./mathematical')\nexports.filter = f => source => sink => source(sink.fusionFilter ? sink.fusionFilter(f) : new Filter(sink, f))\n\nclass Ignore extends Sink {\n    next() { }\n}\nexports.ignoreElements = source => sink => source(new Ignore(sink))\n\nclass Take extends Sink {\n    init(count) {\n        this.count = count\n    }\n    next(data) {\n        this.sink.next(data)\n        if (--this.count === 0) {\n            this.defer()\n            this.complete()\n        }\n    }\n}\nexports.take = deliver(Take)\n\nclass _TakeUntil extends Sink {\n    init(sourceSink) {\n        this.sourceSink = sourceSink\n    }\n    next() {\n        //收到事件，终结两个sink\n        this.sourceSink.complete()\n    }\n}\nclass TakeUntil extends Sink {\n    init(sSrc) {\n        this._takeUntil = new _TakeUntil(null, this).subscribe(sSrc)\n        //将开关事件sink纳入销毁链\n        this.defer(this._takeUntil)\n    }\n    complete(err) {\n        //完成事件，单方面终结开关sink\n        this._takeUntil.dispose()\n        super.complete(err)\n    }\n}\n\nexports.takeUntil = deliver(TakeUntil)\n\nclass TakeWhile extends Sink {\n    init(f) {\n        this.f = f\n    }\n    next(data) {\n        const f = this.f\n        if (f(data)) {\n            this.sink.next(data)\n        } else {\n            this.defer()\n            this.complete()\n        }\n    }\n}\nexports.takeWhile = deliver(TakeWhile)\n\nexports.takeLast = count => reduce((buffer, d) => {\n    buffer.push(d)\n    if (buffer.length > count) buffer.shift()\n    return buffer\n}, [])\n\nclass Skip extends Sink {\n    init(count) {\n        this.count = count\n    }\n    next() {\n        if (--this.count === 0) {\n            this.next = super.next\n        }\n    }\n}\nexports.skip = deliver(Skip)\n\nclass _SkipUntil extends Sink {\n    next() {\n        this.dispose()\n        delete this.sourceSink.next\n    }\n    init(sourceSink) {\n        this.sourceSink = sourceSink\n    }\n}\n\nclass SkipUntil extends Sink {\n    init(sSrc) {\n        this._skipUntil = new _SkipUntil(null, this).subscribe(sSrc)\n        this.defer(this._skipUntil)\n        this.next = noop\n    }\n    complete(err) {\n        this._skipUntil.dispose()\n        super.complete(err)\n    }\n}\nexports.skipUntil = deliver(SkipUntil)\n\nclass SkipWhile extends Sink {\n    init(f) {\n        this.f = f\n    }\n    next(data) {\n        const f = this.f\n        if (!f(data)) {\n            this.next = super.next\n            this.next(data)\n        }\n    }\n}\nexports.skipWhile = deliver(SkipWhile)\n\nconst defaultThrottleConfig = {\n    leading: true,\n    trailing: false\n}\nclass _Throttle extends Sink {\n    init(durationSelector, trailing) {\n        this.durationSelector = durationSelector\n        this.trailing = trailing\n        this.hasValue = true\n        this.isComplete = false;\n    }\n    send(data) {\n        if (this.hasValue) {\n            this.sink.next(data)\n            this.isComplete = false\n            this.durationSelector(data)(this)\n        }\n        this.hasValue = false\n    }\n    next() {\n        this.complete()\n    }\n    complete() {\n        this.defer()\n        this.isComplete = true\n        if (this.trailing) {\n            this.send(this.last)\n        }\n    }\n}\nclass Throttle extends Sink {\n    init(durationSelector, config = defaultThrottleConfig) {\n        this.durationSelector = durationSelector\n        this.leading = config.leading\n        this.trailing = config.trailing\n        this.hasValue = false\n    }\n\n    throttle(data) {\n        this._throttle.isComplete = false\n        this._throttle.last = data\n        this._throttle.hasValue = true\n        this.durationSelector(data)(this._throttle)\n    }\n    next(data) {\n        if (!this._throttle || this._throttle.isComplete) {\n            if (!this._throttle) {\n                this._throttle = new _Throttle(this.sink, this.durationSelector, this.trailing)\n                this.defer(this._throttle)\n            }\n\n            if (this.leading) {\n                this.sink.next(data)\n                this.throttle(data)\n                this._throttle.hasValue = false\n            } else {\n                this.throttle(data)\n            }\n        } else {\n            this._throttle.last = data\n            this._throttle.hasValue = true\n        }\n    }\n    complete(err) {\n        if (err) {\n            this._throttle && this._throttle.dispose()\n            super.complete(err)\n        } else {\n            this._throttle && this._throttle.complete()\n            super.complete()\n        }\n    }\n}\nexports.throttle = deliver(Throttle)\nconst defaultAuditConfig = {\n    leading: false,\n    trailing: true\n}\nexports.audit = durationSelector => exports.throttle(durationSelector, defaultAuditConfig)\n\nclass DebounceTime extends Sink {\n    init(period) {\n        this.period = period\n        this.timerId = null\n    }\n    next(data) {\n        this.buffer = data\n        if (this.timerId) {\n            clearTimeout(this.timerId)\n        }\n        this.timerId = setTimeout(() => {\n            this.sink.next(data)\n            this.timerId = null\n        }, this.period)\n    }\n    complete(error) {\n        if (this.timerId) {\n            clearTimeout(this.timerId)\n            if (!error && this.hasOwnProperty(\"buffer\")) {\n                this.sink.next(this.buffer)\n            }\n        }\n        super.complete(error)\n    }\n}\n\nexports.debounceTime = deliver(DebounceTime)\n\nclass _Debounce extends Sink {\n    next() {\n        this.complete()\n    }\n    complete(err) {\n        this.defer()\n        this.sink.next(this.last)\n        this.isComplete = true\n    }\n}\nclass Debounce extends Sink {\n    init(durationSelector) {\n        this.durationSelector = durationSelector\n    }\n    next(data) {\n        if (!this._debounce) {\n            this._debounce = new _Debounce(this.sink)\n            this.defer(this._debounce)\n        } else if (this._debounce.isComplete) {\n            this._debounce.isComplete = false\n        }\n        this.durationSelector(data)(this._debounce)\n        this._debounce.last = data\n    }\n    complete(err) {\n        if (err) {\n            this._debounce && this._debounce.dispose()\n            super.complete(err)\n        } else {\n            this._debounce && this._debounce.complete()\n            super.complete()\n        }\n    }\n}\n\nexports.debounce = deliver(Debounce)\nclass ElementAt extends Sink {\n    init(count, defaultValue) {\n        this.count = count\n        this.value = defaultValue\n    }\n    next(data) {\n        if (this.count-- === 0) {\n            this.sink.next(data)\n            this.defer()\n            super.complete()\n        }\n    }\n    complete(err) {\n        if (!err) {\n            if (this.value === void 0) err = new Error('not enough elements in sequence')\n            else this.sink.next(this.value)\n        }\n        super.complete(err)\n    }\n}\n\nexports.elementAt = deliver(ElementAt)\nexports.find = f => source => exports.take(1)(exports.skipWhile(d => !f(d))(source))\n\nclass FindIndex extends Sink {\n    init(f) {\n        this.f = f\n        this.i = 0\n    }\n    next(data) {\n        const f = this.f\n        if (f(data)) {\n            this.sink.next(this.i++)\n            this.defer()\n            this.complete()\n        } else {\n            ++this.i\n        }\n    }\n}\n\nexports.findIndex = deliver(FindIndex)\n\nclass First extends Sink {\n    init(f, defaultValue) {\n        this.f = f\n        this.value = defaultValue\n        this.count = 0\n    }\n    next(data) {\n        const f = this.f\n        if (!f || f(data, this.count++)) {\n            this.value = data\n            this.defer()\n            this.complete()\n        }\n    }\n    complete(err) {\n        if (!err) {\n            if (this.value === void 0) err = new Error('no elements in sequence')\n            else this.sink.next(this.value)\n        }\n        super.complete(err)\n    }\n}\n\nexports.first = deliver(First)\n\nclass Last extends Sink {\n    init(f, defaultValue) {\n        this.f = f\n        this.value = defaultValue\n        this.count = 0\n    }\n    next(data) {\n        const f = this.f\n        if (!f || f(data, this.count++)) {\n            this.value = data\n        }\n    }\n    complete(err) {\n        if (!err) {\n            if (this.value === void 0) err = new Error('no elements in sequence')\n            else this.sink.next(this.value)\n        }\n        super.complete(err)\n    }\n}\n\nexports.last = deliver(Last)"],"names":["require","Sink","deliver","noop","Filter","reduce","exports","filter","f","source","sink","fusionFilter","Ignore","ignoreElements","Take","count","data","next","defer","complete","take","_TakeUntil","sourceSink","TakeUntil","sSrc","_takeUntil","subscribe","err","dispose","takeUntil","TakeWhile","takeWhile","takeLast","buffer","d","push","length","shift","Skip","skip","_SkipUntil","SkipUntil","_skipUntil","skipUntil","SkipWhile","skipWhile","defaultThrottleConfig","leading","trailing","_Throttle","durationSelector","hasValue","isComplete","send","last","Throttle","config","_throttle","throttle","defaultAuditConfig","audit","DebounceTime","period","timerId","clearTimeout","setTimeout","error","hasOwnProperty","debounceTime","_Debounce","Debounce","_debounce","debounce","ElementAt","defaultValue","value","Error","elementAt","find","FindIndex","i","findIndex","First","first","Last"],"mappings":"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"}